<!DOCTYPE html>
<html>
<head>
	<title>Loading data ...</title>
	<meta charset="utf-8" />

	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link type="text/css" rel="stylesheet" href="leaflet.css">

	<script src="leaflet.js"></script>
	<script src="leaflet.ajax.min.js"></script>
	<script src="http://localhost:3000/dummy"></script>

	<style>
		body { padding: 0; margin 0; }
		html, body, #mapid { height: 100%;, width: 100%; }
	</style>
</head>

<body>
	<div id="mapid"</div>
	<script>

var map=L.map('mapid');

var geojsonLayer = L.geoJson.ajax("");

function refreshoverlay() {
	var bbox=map.getBounds();

  var url="http://localhost:3000/bbox/db-wayareaconflict/wayareaconflict/" 
		+ bbox.getWest() + "/" 
		+ bbox.getNorth() + "/"
		+ bbox.getEast() + "/"
		+ bbox.getSouth();

  geojsonLayer.refresh(url);//add a new layer replacing whatever is there

	console.log("Refreshoverlay");
	console.log(map.getBounds());
	console.log(url);
}

		var colourlayer=L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
			maxZoom: 18,
			attribution: 'Map data © <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',
			id: 'colour'
		}).addTo(map);

		var bwlayer=L.tileLayer('http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png', {
			maxZoom: 18,
			attribution: 'Map data © <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',
			id: 'greyscale'
		});

		L.control.scale({ imperial: false }).addTo(map);

		map.setView([51.917397,8.3930408], 16);

		L.control.layers(
					{
							"OpenStreetmap": colourlayer,
							"Greyscale": bwlayer
					},{ "Overlay": geojsonLayer }).addTo(map);

		map.on('zoomend', refreshoverlay);
		map.on('dragend', refreshoverlay);

	</script>
</body>
</html>
