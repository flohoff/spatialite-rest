<!DOCTYPE html>
<html>
<head>
	<title>Loading data ...</title>
	<meta charset="utf-8" />

	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link type="text/css" rel="stylesheet" href="leaflet.css">

	<script src="leaflet.js"></script>
	<script src="leaflet.ajax.min.js"></script>
	<script src="leaflet.permalink.min.js"></script>
	<script src="handlebars-v4.0.11.js"></script>
	<script src="jquery-3.3.1.min.js"></script>

	<style>
		body { padding: 0; margin 0; }
		html, body, #mapid { height: 100%;, width: 100%; }
	</style>
</head>

<body>
	<div id="mapid"</div>
	<script>

var db="db-wayareaconflict";
var layer="wayareaconflict";

function geoJsonIter(feat, layer) {
    var out = [];
    if (f.properties){
        for(key in f.properties){
            out.push(key+": "+f.properties[key]);
        }
        l.bindPopup(out.join("<br />"));
    }
}

function refreshoverlay(map, geojsonLayer) {
	var bbox=map.getBounds();

  var url="/spatialite-rest/bbox/"
		+ db + "/"
		+ layer + "/"
		+ bbox.getWest() + "/" 
		+ bbox.getNorth() + "/"
		+ bbox.getEast() + "/"
		+ bbox.getSouth();

  geojsonLayer.refresh(url);
}

var map=L.map('mapid');
var geojsonLayer = L.geoJson.ajax("", { onEachFeature: geoJsonIter });

var colourlayer=L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
	maxZoom: 18,
	attribution: 'Map data © <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',
	id: 'colour'
}).addTo(map);

var bwlayer=L.tileLayer('http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png', {
	maxZoom: 18,
	attribution: 'Map data © <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',
	id: 'greyscale'
});

L.control.scale({ imperial: false }).addTo(map);


L.control.layers(
			{
					"OpenStreetmap": colourlayer,
					"Greyscale": bwlayer
			},{}).addTo(map);

map.addLayer(geojsonLayer);

map.on('zoomend', function() { refreshoverlay(map, geojsonLayer); });
map.on('dragend', function() { refreshoverlay(map, geojsonLayer); });

var mappos = L.Permalink.getMapLocation(16, [51.917397,8.3930408]);
map.setView(mappos.center, mappos.zoom);
L.Permalink.setup(map);

	</script>
</body>
</html>
